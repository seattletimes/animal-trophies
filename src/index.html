<script>
  <% 
    var groupedData = {};
    csv.animalData.forEach(function(row) {
      if (!groupedData[row["control_number"]]) groupedData[row["control_number"]] = {
          shipDate: row["ship_date"],
          components: []
        };
      groupedData[row["control_number"]].components.push(row);
    });
    var array = [];
    for (var group in groupedData) {
      array.push(groupedData[group]);
    }
  %>
  var arrayedData = <%= JSON.stringify(array) %>
</script>

<!doctype html>
<html>
  <head>
    <title><%= json.project.title %></title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <link rel="stylesheet" type="text/css" href="style.css">
    <%= t.include("partials/_head.html") %>
  </head>
  <body ng-app="animal-shipments">

    <responsive-child>

      <div ng-controller="animalController">
        <div class="box" ng-repeat="shipment in shipments"></div>
      </div>

    </responsive-child>

    <script src="app.js" async></script>
    <% if (json.project.production) { %>
    <%= !json.project.embedded ? t.include("partials/_foot.html") : "" %>
    <%= t.include("partials/_workHere.html") %>
    <% } %>
  </body>
</html>
